<template>
    <template if:false={addingPerson}>
        <template if:false={generalFeature}>
            <div>
                <small
                    class="form-text text-muted validity is-invalid form-control mb-2 d-none"
                >
                </small>
                <div class="card mb-2">
                    <div class="card-header">
                        <h5 class="card-title">Text Selection</h5>
                    </div>
                    <div class="card-body">
                        <bib-pop-up-menu
                            entity-name="texts"
                            allow-add="false"
                            onchange={changeText}
                            value={feature.text}
                        >
                        </bib-pop-up-menu>
                    </div>
                </div>
            </div>
            <div class="card mb-2">
                <div class="card-header">
                    <h5 class="card-title">
                        Translation
                        <template if:false={translationExpanded}>
                            <button
                                class="float-right btn btn-sm btn-outline-primary"
                                onclick={toggleTranslationExpanded}
                            >
                                Edit
                            </button>
                        </template>
                    </h5>
                </div>
                <template if:true={translationExpanded}>
                    <div class="card-body">
                        <div class="form-group">
                            <div class="form-row">
                                <div class="col">
                                    <bib-pop-up-menu
                                        label-text="Language"
                                        entity-name="languages"
                                        allow-add="false"
                                        onchange={changeLanguage}
                                        value={feature.language}
                                    >
                                    </bib-pop-up-menu>
                                </div>
                                <div class="col">
                                    <label for="kind">Format</label>
                                    <select
                                        class="form-control format-picklist"
                                        name="kind"
                                        size="1"
                                        onchange={handleChange}
                                        value={feature.proseOrVerse}
                                    >
                                        <option value="Prose">Prose</option>
                                        <option value="Verse">Verse</option>
                                    </select>
                                </div>
                                <div class="col">
                                    <label for="partial">Coverage</label>
                                    <select
                                        class="form-control coverage-picklist"
                                        name="partial"
                                        size="1"
                                        onchange={handleChange}
                                        value={partialValue}
                                    >
                                        <option value="false">
                                            Complete translation
                                        </option>
                                        <option value="true">
                                            Partial translation
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <label for="title">Title</label>
                            <input
                                class="form-control"
                                name="title"
                                placeholder="Title, if different from text"
                                type="text"
                                value={feature.title}
                                onchange={handleChange}
                            />
                            <hr />
                            <label for="description">Description</label>
                            <textarea
                                class="form-control"
                                name="description"
                                placeholder="Description"
                                type="text"
                                value={feature.description}
                                onchange={handleChange}
                            ></textarea>
                            <template if:true={hasSamplePassage}>
                                <label for="sample">Sample Passage</label>
                                <textarea
                                    class="form-control"
                                    name="sample"
                                    value={feature.samplePassage}
                                    onchange={handleChange}
                                ></textarea>
                                <small class="text-muted">
                                    The sample passage for {selectedText.title}
                                    is {selectedText.sample_passage_spec}.
                                </small>
                            </template>
                            <hr />
                            <label for="authors">Translators</label>
                            <bib-dualing-listbox
                                class="persons-listbox"
                                entity-name="persons"
                                allow-add="true"
                                onadd={handleAddPerson}
                                value={feature.authors}
                                onchange={changePersons}
                            >
                            </bib-dualing-listbox>

                            <button
                                class="btn btn-sm btn-outline-primary btn-block mt-3"
                                onclick={toggleTranslationExpanded}
                            >
                                Done
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </template>
        <div class="card mb-2">
            <div class="card-header">
                <h5 class="card-title">
                    Introduction
                    <template if:true={feature.hasIntroduction}>
                        <div
                            class="float-right btn-group btn-group-sm"
                            role="group"
                            aria-label="Feature actions"
                        >
                            <template if:false={introductionExpanded}>
                                <button
                                    class="btn btn-outline-primary"
                                    onclick={toggleIntroductionExpanded}
                                >
                                    Edit
                                </button>
                            </template>
                            <button
                                class="btn btn-outline-danger"
                                onclick={toggleIntroduction}
                            >
                                Remove
                            </button>
                        </div>
                    </template>
                    <template if:false={feature.hasIntroduction}>
                        <button
                            class="float-right btn btn-sm btn-outline-primary"
                            onclick={toggleIntroduction}
                        >
                            Add
                        </button>
                    </template>
                </h5>
                <template if:true={showIntroError}>
                    <small class="text-danger">
                        This feature isn't valid. Edit it before saving.
                    </small>
                </template>
            </div>
            <template if:true={showIntroduction}>
                <div class="card-body">
                    <div>
                        <small>A language and authors are required.</small>
                    </div>
                    <bib-pop-up-menu
                        label-text="Language"
                        entity-name="languages"
                        allow-add="false"
                        onchange={changeIntroLanguage}
                        value={feature.introLanguage}
                    >
                    </bib-pop-up-menu>
                    <label for="introDescription">Description</label>
                    <textarea
                        class="form-control"
                        name="introDescription"
                        placeholder="Optional: description of the introduction provided."
                        type="text"
                        value={feature.introDescription}
                        onchange={handleChange}
                    ></textarea>
                    <label for="introAuthors">Introduction Authors</label>
                    <bib-dualing-listbox
                        entity-name="persons"
                        value={feature.introAuthors}
                        onchange={changeIntroPersons}
                        allow-add="true"
                        onadd={handleAddPerson}
                    ></bib-dualing-listbox>
                    <button
                        class="btn btn-sm btn-outline-primary btn-block mb-3"
                        onclick={toggleIntroductionExpanded}
                    >
                        Done with Introduction
                    </button>
                </div>
            </template>
        </div>
        <div class="card mb-1">
            <div class="card-header">
                <h5 class="card-title">
                    Notes
                    <template if:true={feature.hasNotes}>
                        <div
                            class="float-right btn-group btn-group-sm"
                            role="group"
                            aria-label="Feature actions"
                        >
                            <template if:false={notesExpanded}>
                                <button
                                    class="btn btn-outline-primary"
                                    onclick={toggleNotesExpanded}
                                >
                                    Edit
                                </button>
                            </template>
                            <button
                                class="btn btn-outline-danger"
                                onclick={toggleNotes}
                            >
                                Remove
                            </button>
                        </div>
                    </template>
                    <template if:false={feature.hasNotes}>
                        <button
                            class="float-right btn btn-sm btn-outline-primary"
                            onclick={toggleNotes}
                        >
                            Add
                        </button>
                    </template>
                </h5>
                <template if:true={showNotesError}>
                    <small class="text-danger">
                        This feature isn't valid. Edit it before saving.
                    </small>
                </template>
            </div>
            <template if:true={showNotes}>
                <div class="card-body">
                    <div>
                        <small>A language and authors are required.</small>
                    </div>
                    <bib-pop-up-menu
                        label-text="Language"
                        entity-name="languages"
                        allow-add="false"
                        onchange={changeNotesLanguage}
                        value={feature.notesLanguage}
                    >
                    </bib-pop-up-menu>
                    <label for="notesDescription">Description</label>
                    <textarea
                        class="form-control"
                        name="notesDescription"
                        placeholder="Optional: description of the notes provided."
                        type="text"
                        value={feature.notesDescription}
                        onchange={handleChange}
                    ></textarea>
                    <label for="notesAuthors">Notes Authors</label>
                    <bib-dualing-listbox
                        entity-name="persons"
                        value={feature.notesAuthors}
                        allow-add="true"
                        onadd={handleAddPerson}
                        onchange={changeNotesPersons}
                    ></bib-dualing-listbox>
                </div>
                <button
                    class="btn btn-sm btn-outline-primary btn-block mb-3"
                    onclick={toggleNotesExpanded}
                >
                    Done with Notes
                </button>
            </template>
        </div>
        <template if:false={generalFeature}>
            <hr />
            <button class="btn btn-primary btn-block mb-3" onclick={save}>
                Done with Translation
            </button>
        </template>
    </template>
    <template if:true={addingPerson}>
        <h4>
            <button
                class="btn btn-outline-secondary mr-3"
                onclick={stopAddingPerson}
            >
                &lt; Back
            </button>
            Adding New Author
        </h4>
        <bib-add-person onsave={personAdded}></bib-add-person>
    </template>
</template>
