<template>
    <template if:false={showingModal}>
        <div>
            <h2>
                Publication Details
                <template if:false={detailsExpanded}>
                    <button class="float-right btn btn-outline-primary" onclick={toggleDetails}>Edit</button>
                </template>
            </h2>
            <template if:true={detailsExpanded}>
                <small class="form-text text-muted mb-2">
                    Enter details about this volume. A title, published date, and publisher are required.
                </small>

                <div class="details">
                    <form class="needs-validation" novalidate>
                        <div class="form-group">
                            <div class="form-row">
                                <div class="col-6">
                                    <label for="title">Title</label>
                                    <input class="form-control" name="title" placeholder="Title" type="text"
                                        value={title} onchange={handleChange} required></input>
                                    <div class="invalid-feedback">
                                        Please enter a title.
                                    </div>
                                </div>
                                <div class="col">
                                    <bib-pop-up-menu label-text="Primary Language" entity-name="languages"
                                        allow-add="false" onchange={handlePrimaryLanguageChange}
                                        value={primaryLanguage}>
                                    </bib-pop-up-menu>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col-6">
                                    <bib-pop-up-menu label-text="Publisher" class="publisher-popup"
                                        entity-name="publishers" allow-add="true" onchange={handlePublisherChange}
                                        onadd={toggleAddingPublisher} value={publisher}>
                                    </bib-pop-up-menu>
                                    <div class="invalid-feedback">
                                        Please select or create a publisher.
                                    </div>
                                </div>
                                <div class="col">
                                    <label for="date">Publication Date</label>
                                    <input class="form-control" name="date" type="date" value={published_date}
                                        onchange={handleChange} required></input>
                                    <div class="invalid-feedback">
                                        Please enter a publication date.
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="col">
                                    <label for="isbn">ISBN</label>
                                    <input class="form-control" name="isbn" placeholder="ISBN, if available" type="text"
                                        value={isbn} onchange={handleChange}></input>
                                </div>
                                <div class="col">
                                    <label for="oclc">OCLC Number</label>
                                    <input class="form-control" name="oclc" placeholder="OCLC number, if available"
                                        type="text" value={oclc_number} onchange={handleChange}></input>
                                </div>
                            </div>
                            <label for="description">Description</label>
                            <input class="form-control" name="description" placeholder="Description" type="text"
                                value={description} onchange={handleChange}></input>
                        </div>
                        <button type="submit" class="btn btn-outline-primary btn-block mb-3" onclick={toggleDetails}>
                            Done with Details
                        </button>
                    </form>
                </div>
            </template>

            <h2>Contents</h2>

            <h3 class="mt-3">General Features</h3>
            <small class="form-text text-muted mb-2">
                Add features of the volume as a whole, like general introductions and notes that aren't
                associated with a specific translation. Introductions to specific texts should be part of the
                translation.
            </small>
            <div class="volume-features">
                <bib-feature-editor feature={generalFeatures} general-feature="true"
                    onchange={handleGeneralFeatureChange} onaddperson={toggleAddingPerson}>
                </bib-feature-editor>
            </div>

            <h3 class="mt-3">
                Translations
                <div class="float-right">
                    <button class="btn btn-outline-primary" onclick={addFeature}>
                        Add
                    </button>
                </div>
            </h3>
            <small class="form-text text-muted mb-1">
                Add translations to this volume. At least one translation is required.
            </small>

            <div class="translations">
                <template for:each={features} for:item="item">
                    <div class="mb-2" key={item.id}>
                        <bib-feature-display class="feature-display" feature={item} data-item={item.id}
                            onedit={handleFeatureEdit} onremove={handleFeatureRemove}>
                        </bib-feature-display>
                    </div>
                </template>
            </div>
            <hr>
            <small class="text-danger form-validity mb-2">{error}</small>
            <div class="status text-center mb-2 d-none">
                <div class="spinner-grow spinner-grow-sm mr-2" role="status">
                </div>
                Creating records...
            </div>
            <button class="btn btn-primary btn-block mb-3" onclick={create}>Create Volume</button>
        </div>
    </template>
    <template if:true={showingTranslationModal}>
        <h4>
            <button class="btn btn-outline-secondary mr-3" onclick={toggleEditingFeature}>
                &lt; Back
            </button>
            Editing Translation
        </h4>
        <bib-feature-editor class="feature-editor" feature={featureToEdit} onchange={handleFeatureChange}
            onsave={toggleEditingFeature} onaddperson={toggleAddingPerson}>
        </bib-feature-editor>
    </template>
    <template if:true={addingPublisher}>
        <h4>
            <button class="btn btn-outline-secondary mr-3" onclick={toggleAddingPublisher}>
                &lt; Back
            </button>
            Adding New Publisher
        </h4>
        <bib-add-publisher onsave={publisherAdded}></bib-add-publisher>
    </template>
    <template if:true={addingPerson}>
        <h4>
            <button class="btn btn-outline-secondary mr-3" onclick={toggleAddingPerson}>
                &lt; Back
            </button>
            Adding New Person
        </h4>
        <bib-add-person onsave={toggleAddingPerson}>
        </bib-add-person>
    </template>

</template>