<template>
    <div class="main-block">
        <div class="tab-content">
            <h2>
                Publication Details
            </h2>
            <small class="form-text text-muted mb-2">
                Enter details about this volume. A title, published date, and publisher are required.
            </small>

            <div class="details" data-tab="data">
                <div class="form-group">
                    <div class="form-row">
                        <div class="col-6">
                            <label for="title">Title</label>
                            <input class="form-control" name="title" placeholder="Title" type="text" value={title}
                                onchange={handleChange}></input>
                        </div>
                        <div class="col">
                            <bib-pop-up-menu label-text="Primary Language" entity-name="languages" allow-add="false"
                                onchange={changePrimaryLanguage} value={primaryLanguage}>
                            </bib-pop-up-menu>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-6">
                            <bib-pop-up-menu label-text="Publisher" class="publisher-popup" entity-name="publishers"
                                allow-add="true" onchange={handlePublisherChange} onadd={addPublisher}
                                value={publisher}>
                            </bib-pop-up-menu>
                        </div>
                        <div class="col">
                            <label for="date">Publication Date</label>
                            <input class="form-control" name="date" type="date" value={published_date}
                                onchange={handleChange}></input>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col">
                            <label for="isbn">ISBN</label>
                            <input class="form-control" name="isbn" placeholder="ISBN, if available" type="text"
                                value={isbn} onchange={handleChange}></input>
                        </div>
                        <div class="col">
                            <label for="oclc">OCLC Number</label>
                            <input class="form-control" name="oclc" placeholder="OCLC number, if available" type="text"
                                value={oclc_number} onchange={handleChange}></input>
                        </div>
                    </div>
                    <label for="description">Description</label>
                    <input class="form-control" name="description" placeholder="Description" type="text"
                        value={description} onchange={handleChange}></input>
                </div>
            </div>
            <h2>
                Contents
            </h2>
            <h3 class="mt-3">General Features</h3>
            <small class="form-text text-muted mb-2">
                Add features of the volume as a whole, like general introductions and notes that aren't
                associated with a specific translation.
            </small>
            <div class="volume-features">
                <bib-feature-editor feature={generalFeatures} general-feature="true"
                    onchange={handleGeneralFeatureChange}></bib-feature-editor>
            </div>
            <h3 class="mt-3">
                Translations
                <div class="float-right">
                    <button class="btn btn-outline-primary" onclick={addFeature}>
                        Add
                    </button>
                </div>
            </h3>
            <small class="form-text text-muted mb-1">
                Add translations to this volume.
            </small>

            <div class="translations">
                <template for:each={features} for:item="item">
                    <div class="mb-2" key={item.id}>
                        <bib-feature-display class="feature-display" feature={item} data-item={item.id}
                            onedit={handleFeatureEdit} onremove={handleFeatureRemove}>
                        </bib-feature-display>
                    </div>
                </template>
            </div>
            <hr>
            <input class="btn btn-primary btn-block mb-3" type="button" onclick={create} value="Create Volume"></input>
        </div>
    </div>
    <template if:true={editingFeature}>
        <h4>
            <button class="btn btn-outline-secondary mr-3" onclick={stopEditingFeature}>
                &lt; Back
            </button>
            Editing Translation
        </h4>
        <bib-feature-editor class="feature-editor" feature={featureToEdit} onchange={handleFeatureChange}
            onsave={stopEditingFeature}>
        </bib-feature-editor>
    </template>
    <template if:true={addingPublisher}>
        <h4>
            <button class="btn btn-outline-secondary mr-3" onclick={stopAddingPublisher}>
                &lt; Back
            </button>
            Adding New Publisher
        </h4>
        <bib-add-publisher onsave={publisherAdded}></bib-add-publisher>
    </template>
</template>